Warning: this file/format is in development. Proceed with caution. Godspeed!

Changes needed:
1. remove state switch, just add way to put in parameters manually that state switch gets
2. add regex for all parameters
3. write how to

#############################
#### How to use this file ###
#############################

All parameters start with a '~'. this is how they are regex'd into a list with the SetParameters function. All parameteres are described starting with the *. This is not regex'd anywhere, but is formatted this way for clarity.

To add a new parameter, just use the following format. Make sure there's a space between '='

# ~ Parm = val

To temporarily remove a parameter, just remove the ~ and they will be ignored

###########################
#### General parameters ###
###########################
* nrep, number of replicates
* thyme, total number of time steps. is spelled 'thyme' bc 'time' is a function in stats namespace 

~ nrep = 2
~ thyme = 18

############################
#### Movement parameters ###
############################

* shape, gamma distribution shape parameter
* rate, gamma distribution rate parameter

These are original movement gamma distribution parameters from Kim's state switch model (FL= slow pigs, SC= fast pigs)
xFL=c(0.7515,0.3550)
xSC=c(0.5657,1.9082)

If using movement parameters fed in from landscapes, remove the ~
## replaced with the state switch setup at the bottom
shape = 0.7515
rate = 0.3550

##################################
#### Movement option settings ####
##################################
* mv_pref, movement preference switch
  0=random movement preference (distance-only)
  1=abundance-avoidance movement preference
  2=rsf preference (only works when pop_init_grid_opts="heterogeneous" and grid_opts!="homogeneous")
  
~ mv_pref = 2

###########################
#### Contact parameters ###
###########################

* F1, pig contact probability if in same cell, numeric
	F1 FL - 0.7380952
	F1 SC - 0.9375
* F2, pig contact probability with distance, glm model object
* F2i, pig contact probability with distance from 'carcass', glm model object
	^ currently, F2 and F2i need to be read in as glms as rds objects. 
	in future, want to manually input the intercept and coefficient

Originally, these were all pulled into model with 'ModelStateSwitch.R' by reading in pairwise contact data from field studies

## Transmission rate within grid cells -- "omega_w" in 2022 paper
~ F1__FL = 0.7380952
~ F1__SC = 0.9375

### Florida values
## Direct contact rate among grid cells "f(omega_d)" -- alpha, beta
~ F2_int__FL = -0.800939073371641
~ F2_B__FL = -1.91283149755244
## Indirect (carcass) contact rate among grid cells "f(omega_d)" -- alpha, beta
~ F2i_int__FL = 2.32150593181132
~ F2i_B__FL = -6.3722548347205

### S. Carolina values
## Direct contact rate among grid cells "f(omega_d)" -- alpha, beta
~ F2_int__SC = 0.64
~ F2_B__SC = -1.16
## Indirect (carcass) contact rate among grid cells "f(omega_d)" -- alpha, beta
~ F2i_int__SC = 9.82
~ F2i_B__SC = -4.11

K = 1500
## carrying capacity; currently hard-coded in RunSimulationFunction.R
## could go with K_factor = 1.5 or something like that


##################################
#### Pig population parameters ###
##################################

* density, pigs/km2. Recommended density levels: 1.5, 3, 5 pigs/km2, for initial distribution
* ss, sounder size targetr for initial distribution
* B1 -- "phi" in 2022 paper -- scaling parameter for transmission probability given contact among grid cells -- direct transmission

For now, sounder size (ss) and probability of infection given contact (B1) will be automatically determined based on input density levels as follows:
	FL:
		density 1.5, ss=2, B1=0.9
		density 3, ss=4, B1=0.4
		density 5, ss=6, B1=0.2
	SC:
		density 1.5, ss=2, B1=0.009
		density 3, ss=4, B1=0.004
		density 5, ss=6, B1=0.002

B2 automatically calculated as B1*0.5

density = 1.5

##############################
#### Grid option settings ####
##############################

These two parameters only need to be set if manually creating heterogeneous or homogeneous grids. If using a raster/raster collection, no need:
* len, nrow/ncol of grid. note that there is only one number for the grid dimensions! grid must be square
* inc, resolution of the grid in kilometers
## Note that in the model some of these dimensions are hard-coded (e.g. 40K cells)

~ len = 200
~ inc = 0.5

* grid.opts, character, grid option for input type and whether to incorporate land class if creating grid from scratch. If using a raster input, you can ignore this input. If inputting a raster to the InitializeGrids function, this value defaults to 'ras'. If making a grid by inputting len/inc, default is homogeneous.
	ras- use input raster to create grid
	homogeneous- creates grid with 7 columns, no land class variables
    heterogeneous- creates a neutral random landscape model with land class values draw from uniform distribution and rescaled from 0 to 1. Note, if pop_init_grid_opts='heterogeneous', grid.opts MUST be something other than 'homogeneous' or InitializeSounders will throw an error.
* pop_init_grid_opts = how to initialize sounders on the grid-- do it with biased preference according to lscape vals or just randomly (if you use homogenous or ras, it is random; heterogeneous is according to landscape)

Gets rewritten to heterogeneous if you put in a raster or enter raster here
grid.opts = "homogeneous"
grid.opts = "heterogeneous"
~ grid.opts = "ras"
pop_init_grid_opts = "homogeneous"
~ pop_init_grid_opts = "heterogeneous"
doesn't work, defaults to heterogeneous
pop_init_grid_opts = "ras"

  
#################################
#### Surveillance parameters ####
#################################
* detectday, Timestep of simulation to start surveillance. Yes it's named 'detectday' even though timesteps are in weeks.

### for no culling or detection for the duration
~ detectday = 9999
detectday = 20
  
* DetP, probability of infected pigs sampled as positive. for now, is just used as an input in some of the sounderlocs output processing steps. later, may be integrated into culling/surveillance process within simulation.

~ DetP = 1

* sample, option to include specific sampling scheme for a county. Sample format for this file can be found here: "Input/sampling_scheme_template.csv"
* This feature currently requires a county landclass preference file to construct grid. Initial implementation required county shapefile but this is deprecated.

~ sample = 0

#############################
#### Culling parameters #####
#############################
* alphaC, scaling parameter on relationship of effort to capture success
* Rad=0, culling radius
* intensity=0.05, proportion of population targeted for removal per day based on capabilities
* cullstyle="startOUT", option in original ASF opt rad 2022 model
* Intensity = 0.05, proportion of population targeted for removal per day based on capabilities

~ alphaC = 1.1
~ Rad = 5
Rad = c(10,20)
~ cullstyle = "startIN"
cullstyle = "startOUT"
~ Intensity = 0.05

#####################################
#### Epidemiological parameters #####
#####################################

* Pir, proportion of individuals that recover instead of die
* num_inf_0=1, how many pigs to infect starting off
* Pcr, transition probability from carcass to removal from landscape

~ Pir = 0.05
~ num_inf_0 = 1
~ Pcr = 0.23

#########################################
#### Population dynamics parameters #####
#########################################

* death, probability of natural death
* Pbd, weekly birth rate

This translates to about 71% survival rate, but I can't find supporting information in the citation (Snow 2020 chapter), they say average survival is 0.56, up to 0.91, but I think the original parameter value here is based on a different value and probably dividied by 52 or 4 to get this. This is actually really high given that it is a background death rate on top of a logistic equation model of "reproductive rate" that is really a population growth rate model
death = 0.00639
### from matlab model: death = 7/(365*3);%Pbd*(1/1.5); % assume pop growth rate of 1.5 so make death rate = birth rate*(1/1.5); 1/(365*3); % natural death rate for S and R
Using annual survival of 0.56, 1-0.56=1-(1-d_week)^52 -> d_week of 0.011 from Snow 2020 chapter 4
~ death = 0.011

Birth rate is probably not this... Based on fig 1 in mayer 2009 p 67 of 304 litters distribtuted thoughout a year, so the quackulation is 304/52 = 5.85 to get litters per week, and then 5.85 l/w /304 litters to get 0.0192 w^-1. But it ignores the underlying rate of reproduction, i.e. the plot is saying how many litters happened in which month (comception vs. the pig word for birth) but not how many total pigs were sampled, only how many litters. It works for seasonality (~10% of conceptions in January, for example) but NOT for birth rate.
I would say, based on my reading, that we can assume ~1.5 litters per year (depending on environment... and age) given gestation of about 120 days (100-140, probably average closer to 115) and weaning at about 2 months (1-4 months range) we have a full reproductive cycle of about 180 days or 6 months, so maybe about 2 litters per year. Then litter size tends to be about 5, so we are looking at annual per-capita reproduction of 5 to 10 piglets per individual, depending on litters per year and survival. so I get a reproductive rate of 0.096 (1 litter of 5) to 0.192 (2 litters of 5) per reproductive female. that is a lot higher than the previously (and stupidly) assumed parameter originally estimated for this model.
~ Pbd = 0.096
Pbd = 0.0192
From matlab model: % BIRTH PROBABILITY
%conc = [32 18 15 15 4 15 8 35 65 52 22 23]; % Monthly data from SREL - describes conception seasonality
conc = [81 31 23 28 26 18 15 12 5 14 11 40]; % Monthly data from SREL - describes birth seasonality
c_time = []; % seasonal birth rate
for iiii = 1:length(enddate)
c_time = [c_time conc(iiii).*ones(1,enddate(iiii))];
end
c_time = c_time/sum(c_time);
mc_time = mean(c_time); %mean daily conception probability
%c_time = repmat(mean(c_time),1,365*5);


THE OTHER THING about using the carrying capacity in this way is it bases the birth rate on density across the entire simulation space, which would be fine right up until you start culling -- then you are reducing the total number of pigs but keeping carrying capacity the same, so even areas several kilometers away from the culling zone will have increased reproduction, magically, because pigs were killed somewhere else. This could create an artefact of having high density rebounds outside the control zone, and therefore increasing spread globally potentially pushing the infection to spread farther.


#########################
#### Output options #####
#########################

* out.opts, character vector of selected output options. options include "sounderlocs","idzone","alldetections","incidence". if none selected (i.e., out.opts=c()), just get standard outputs

	** sounderlocs: subset of pop matrix taken at each timestep: rows where there is a pig in any state, number in each status, and the cell number (location). first col is timestep number. this can get quite large-- not good practice to just merge across 500-1000 reps. summary options for replicates: sum of num SEIRCZ across each timestep, each replicate (tracking population/state changes)

	** idzone: matrix with timestep in first column, second column is each cell within control zone at each timestep. This can also get quite large. Mostly for plotting/visualization for checking individual replicates. No cross-replicate summary options at the moment.

	** alldetections: matrix with each row timestep, col1 timestep, col2=type (1 is live, 0 is dead), col3 is number of live/dead detected at each timestep, col4 is locations of detections. cross replicate summary-- just add rep column, rbind for each replicate. for now only include number.. later can add opt to output locs if/when needed

	** incidence: matrix with timestep, num exposed, num infected, and assoc. locs. can get large, cross-replicate summaries for now ignore locs, just summarise num exp/inf across timestep. in future, will add num susc to this to calculate different measures of Rt.

~ out.opts = c("sounderlocs","idzone","alldetections","incidence")


### Selection of variables to include in variable definition, i.e. which parameters are changing as experimental inputs
##I think this was missed before, and band-aid solution implemented in _targets.R

input = c("shape_rate","density_ss_B1_B2")#,"Radius")
~ input = c("state","density_ss","B1_B2")


These can be changed, but are the foundational values for the state-based movement models.
To select one state over the other, set state=FL or SC. Other state values could be added as
necessary, using the same form (e.g. state=c("AZ"), shape__AZ, rate__AZ, B1__AZ). Anything with
A range of values will be used as a distinct parameter combination UNLESS it is B1__[state],
density, or ss because these are associated (thus they should be the same length).
B2_B1_factor is the conversion between B1 and B2 parameters, generally 0.5 (B2 = B1*0.5).


state = c("FL")
~ state = c("FL","SC")
~ shape__FL = 0.7515
~ rate__FL = 0.3550
B1__FL = c(0.9, 0.2)
~ B1__FL = c(0.9, 0.4, 0.2)

~ shape__SC = 0.5657
~ rate__SC = 1.9082
B1__SC = c(0.004)
B1__SC = c(0.009, 0.002)
~ B1__SC = c(0.009, 0.004, 0.002)

~ B2_B1_factor = 0.5
density = c(1.5)
density = c(1.5, 5)
~ density = c(1.5, 3, 5)
ss = c(2)
ss = c(2, 6)
~ ss = c(2, 4, 6)


















